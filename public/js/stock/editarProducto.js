import{cargarDropDowns,recargarTabla,previewImagen,limpiarFormulario,mostrarSpinner}from"./helpers.js";let llenarCampos=a=>{$.ajax({url:""+window.location.origin+endpoints.productosApi+"/"+a,method:"GET",success:a=>{$("#sku").val(a.sku),$("#nombre").val(a.nombre),$("#stock").val(""),$("#precio").val(a.precio),$("#marca").val(a.marcaId),$("#categoria").val(a.categoriaId),$("#capacidad").val(a.capacidad),$("#unidadMedida").val(a.unidadId),$("#proveedor").val(a.proveedorId),$("#previewImage").attr("src",a.img),$("#stockActual").text(a.stock),$("#stockInfoActual").removeClass("d-none"),$("#stockActual").removeClass("d-none")},error:a=>{console.error("Error al cargar el producto",a)}})},actualizarStock=()=>{console.log("Info actual",parseInt($("#stockActual").text()));var a=parseInt($("#stock").val())+parseInt($("#stockActual").text());$("#stockInfoPosterior").text(`NUEVO stock a guardar= ${a} ---> Valor anterior:${parseInt($("#stockActual").text())} + Valor ingresado:`+parseInt($("#stock").val())),$("#stockInfoPosterior").addClass("bg-custom-green mt-2 p-2 text-dark rounded fw-bold"),$("#stockInfoPosterior").removeClass("d-none")};export default t=>{$("#productos").on("click",".editar",async function(){$("#stock").on("change",function(){actualizarStock()}),limpiarFormulario();let r=$(this).data("id");$("#sku").prop("disabled",!0),$("#stock").prop("required",!1),await cargarDropDowns(),llenarCampos(r),previewImagen(),$("#formModalId").off("submit").on("submit",function(a){a.preventDefault(),mostrarSpinner(!0);var o,a=new FormData(this);$("#stock").val()?(o=parseInt($("#stock").val())+parseInt($("#stockActual").text()),a.set("stock",o)):a.set("stock",parseInt($("#stockActual").text())),""===$("#formFile").val()&&a.delete("imagen"),$.ajax({url:""+window.location.origin+endpoints.editarProducto+"/"+r,type:"PUT",data:a,contentType:!1,processData:!1,success:function(a){swal(a.message,"Editado","success"),recargarTabla(t),mostrarSpinner(!1),$("#modalProducto").modal("hide")},error:function(a,o,r){a=JSON.parse(a.responseText).message;mostrarSpinner(!1),swal(a,"Error al editar","error")}})})})};